version: '3.8'

services:
  protocol-tests:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ../protocol:/app/protocol:ro
    environment:
      - GO111MODULE=on
    command: ["./run_tests.sh"]
    working_dir: /app

  # Alternative service for running specific test commands
  test-runner:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ../protocol:/app/protocol:ro
    environment:
      - GO111MODULE=on
    command: ["go", "test", "-v", "./protocol"]
    working_dir: /app

  # Service for running tests with coverage
  test-coverage:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ../protocol:/app/protocol:ro
    environment:
      - GO111MODULE=on
    command: ["go", "test", "-v", "-cover", "./protocol"]
    working_dir: /app
